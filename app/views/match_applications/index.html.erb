<h1>申請一覧</h1>

<p>
  募集日: <%= @match_listing.match_date %>
  <%= @match_listing.start_time.strftime("%H:%M") %> - <%= @match_listing.end_time.strftime("%H:%M") %>
  / 状態: <%= I18n.t("activerecord.attributes.match_listing.status.#{@match_listing.status}") %>
</p>

<h2>未処理</h2>

<% if @pending_apps.any? %>
  <table>
    <thead>
      <tr>
        <th>申請者</th>
        <th>メッセージ</th>
        <th>状態</th>
        <th>申請日時</th>
        <th>操作</th>
      </tr>
    </thead>
    <tbody>
      <% @pending_apps.each do |app| %>
        <tr>
          <td><%= app.applicant&.name || "User##{app.applicant_id}" %></td>
          <td><%= app.message %></td>
          <td><%= I18n.t("activerecord.attributes.match_application.status.#{app.status}") %></td>
          <td><%= app.created_at.strftime("%Y/%m/%d %H:%M") %></td>
          <td>
            <%= button_to "承認",
                  approve_match_listing_match_application_path(@match_listing, app),
                  method: :patch,
                  data: { turbo_confirm: "承認しますか？" } %>

            <%= button_to "却下",
                  reject_match_listing_match_application_path(@match_listing, app),
                  method: :patch,
                  data: { turbo_confirm: "却下しますか？" } %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
<% else %>
  <p>未処理の申請はありません。</p>
<% end %>

<hr>

<h2>処理済み</h2>

<% if @handled_apps.any? %>
  <table>
    <thead>
      <tr>
        <th>申請者</th>
        <th>メッセージ</th>
        <th>状態</th>
        <th>申請日時</th>
      </tr>
    </thead>
    <tbody>
      <% @handled_apps.each do |app| %>
        <tr>
          <td><%= app.applicant&.name || "User##{app.applicant_id}" %></td>
          <td><%= app.message %></td>
          <td>
            <% if app.approved? %>
              <span style="display:inline-block; padding:2px 8px; border-radius:12px; background:#e6ffed; border:1px solid #b7f5c6;">
                承認済み
              </span>
            <% elsif app.rejected? %>
              <span style="display:inline-block; padding:2px 8px; border-radius:12px; background:#fee2e2; border:1px solid #fecaca;">
                却下
              </span>
            <% elsif app.canceled? %>
              <span style="display:inline-block; padding:2px 8px; border-radius:12px; background:#f3f4f6; border:1px solid #d1d5db;">
                取消
              </span>
            <% end %>
            <%= I18n.t("activerecord.attributes.match_application.status.#{app.status}") %>
          </td>
          <td><%= app.created_at.strftime("%Y/%m/%d %H:%M") %></td>
        </tr>
      <% end %>
    </tbody>
  </table>
<% else %>
  <p>処理済みの申請はありません。</p>
<% end %>
